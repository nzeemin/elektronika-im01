
; Вход по включению питания
020000  MOV     #003000, 177760
; Точка входа для пересброса - прерывание по вектору 4 (RPLY), 10 (резервный код команды) / 24 (ACLO)
020006  MOV     #000200, SP
020012  RESET   
020014  MTPS    #000340
020020  CLR     000076
020024  MOV     #020444, 000004     ; Адрес прерывания по вектору 4 (RPLY)
020032  MOV     #000340, 000006     ; PSW
020040  MOV     #020060, R0
020044  MOV     #063000, 177750
020052  BR      020060
;
020054  ADD     @157650(R0), R0
;
020060  MOV     #030561, 170004
020066  MOV     #000037, 170060
020074  CLR     170074	            ; Очищаем регистр Д
020100  MOV     #020000, R0         ; с адреса 020000
020104  MOV     #020000, R1         ; 020000 байт = 8К
020110  MOV     #000200, R5         ; индикаторный бит
020114  CALL    057000	            ; Проверить контрольную сумму
020120  MOV     #040000, R0         ; с адреса 040000
020124  MOV     #020000, R1         ; 020000 байт = 8К
020130  CALL    057000	            ; Проверить контрольную сумму
020134  MOV     #000200, R0         ; с адреса 000200
020140  MOV     #001600, R1         ; 896. байт
020144  CALL    057030              ; Проверка блока памяти
020150  MOV     #002000, R0         ; с адреса 002000
020154  MOV     #002000, R1         ; 1К байт
020160  CALL    057030              ; Проверка блока памяти
020164  TSTB    000076              ; Было прерывание RPLY?
020170  BNE     020176              ; да => пропускаем
020172  CALL    057244              ; Проверить память 060000..061777 и ПЗУ 064000..067777
020176  BIT     #000377, 170074     ; Проверяем регистр Д
020204  BNE     020100	            ; КС не совпала / ошибки памяти - на повторную проверку
020206  MOV     #000200, R0         ;
020212  CLR     (R0)+               ; очищаем 000200..003777
020214  CMP     R0, #004000         ;
020220  BLT     020212              ;
020222  MOV     #020006, R0         ; Адрес точки пересброса
020226  MOV     R0, 000004          ; прерывание по вектору 4 - RPLY
020232  MOV     R0, 000010          ; прерывание по вектору 10 - резервный код команды
020236  MOV     R0, 000024          ; прерывание по вектору 24 - ACLO
020242  MOV     #021712, 000222
020250  MOV     #021642, 000224
020256  MOV     #000500, 170072
020264  MOV     #020536, 000100	    ; Адрес прерывания по вектору 100 - EVNT
020272  MOV     #000340, 000102     ; PSW
020300  MOV     #000340, 000272
020306  MOV     #054114, 000270
020314  CLRB    000212
020320  TSTB    000076
020324  BNE     020376
020326  CALL    064410
020332  MOV     #000006, 170106
020340  MOV     #000310, 170104
020346  MOV     #000230, 170100
020354  CALL    054042
020360  MOV     #000000, 170100
020366  NOP     
020370  MOV     #000230, 170100
020376  CALL    022206
020402  MOVB    #000001, 000203
020410  MOVB    #000001, 000204
020416  MOV     #000001, 001250
020424  MOV     #021606, 000224
020432  MTPS    #000000
020436  INC     003736
020442  BR      020436
; Прерывание по вектору 4 - RPLY
020444  MOVB    #000077, 000076     ; Ставим флаг что было прерывание
020452  MOV     R0, (SP)
020454  RTI   
;  
020456  INCB    000214
020462  ASRB    000212
020466  BNE     020502
020470  MOVB    #000040, 000212
020476  CLRB    000214
020502  MOVB    000214, R1
020506  CLR     170074
020512  BIC     #000077, 170060
020520  BISB    000212, 170060
020526  MOVB    000214(R1), 170074
020534  RETURN  
;
; Прерывание по вектору 100 - EVNT
020536

; Подпрограмма: Проверить контрольную сумму
057000  BIC     R5, 170074
057004  CLR     R2
057006  ADD     (R0)+, R2
057010  DEC     R1
057012  SOB     R1, 057006
057014  TST     R2
057016  BEQ     057024
057020  BIS     R5, 170074
057024  ASR     R5
057026  RETURN  
; Подпрограмма: Проверка блока памяти
057030  BIC     R5, 170074          ; стираем бит в регистре Д
057034  MOV     #000001, -(SP)
057040  MOV     R0, R3
057042  MOV     R1, R4
057044  MOV     (SP), R2
057046  MOV     R3, R0
057050  MOV     R4, R1
057052  MOVB    R2, (R0)+
057054  ASLB    R2
057056  BNE     057062
057060  INC     R2
057062  SOB     R1, 057052
057064  MOV     (SP), R2
057066  MOV     R3, R0
057070  MOV     R4, R1
057072  CMPB    R2, (R0)+
057074  BEQ     057102
057076  BIS     R5, 170074          ; ошибка памяти - ставим бит в регистре Д
057102  ASLB    R2
057104  BNE     057110
057106  INC     R2
057110  SOB     R1, 057072
057112  ASLB    (SP)
057114  BNE     057044
057116  TST     (SP)+
057120  BR      057024              ; заканчиваем
;
057122  MOV     001250, R2
057126  MOV     003734, R4
057132  MOV     001374, R5
057136  MOV     #000236, R3
057142  CLR     (R3)+
057144  CMP     R3, #000660
057150  BLT     057142
057152  ADD     #000100, R3
057156  CLR     (R3)+


; Подпрограмма: проверить память 060000..061777 и ПЗУ 064000..067777
057244  MOV     #060000, R0         ; С адреса 060000
057250  MOV     #002000, R1         ; 02000 байт = 1К
057254  CALL    057030              ; Проверка блока памяти
057260  MOV     #064000, R0         ; С адреса 064000
057264  MOV     #004000, R1         ; 04000 байт = 2К
057270  CALL    057000	            ; Проверить контрольную сумму
057274  RETURN  


064410
